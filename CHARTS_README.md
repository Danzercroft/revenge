# Документация: Графики свечей

## Описание

Реализована функциональность отображения интерактивных графиков свечей (candlestick charts) с использованием библиотеки `lightweight-charts`.

## Что было создано

### 1. Компонент CandlestickChart

- **Файл**: `resources/js/components/CandlestickChart.tsx`
- **Назначение**: React-компонент для отображения графиков свечей
- **Возможности**:
    - Интерактивный график с зумом и панорамированием
    - Автомасштабирование
    - Адаптивность под размеры экрана
    - Поддержка тем (светлая/темная)

### 2. Страница графиков

- **Файл**: `resources/js/pages/charts.tsx`
- **Маршрут**: `/charts`
- **Назначение**: Интерфейс для настройки и просмотра графиков
- **Функциональность**:
    - Выбор валютной пары, биржи и таймфрейма
    - Фильтрация по датам
    - Ограничение количества свечей
    - Получение статистики
    - Интерактивный график

### 3. API для графиков

Используются существующие API endpoints из `CandleController`:

- `GET /api/candles/meta` - получение доступных пар, бирж и таймфреймов
- `GET /api/candles` - получение данных свечей
- `GET /api/candles/stats` - получение статистики

### 4. Контроллер веб-страницы

- **Файл**: `app/Http/Controllers/ChartController.php`
- **Назначение**: Обработка веб-маршрута для страницы графиков

### 5. Навигация

Добавлена ссылка "Графики свечей" в боковую панель приложения.

### 6. Тестовые данные

- **Файл**: `database/seeders/CandleSeeder.php`
- **Назначение**: Создание тестовых данных свечей
- **Количество**: ~1800 свечей для разных комбинаций пар/бирж/таймфреймов

## Использование

### Запуск приложения

1. Убедитесь, что Docker-контейнеры запущены:

    ```bash
    docker-compose up -d
    ```

2. Выполните миграции и сидеры (если еще не выполнены):

    ```bash
    docker-compose exec app php artisan migrate
    docker-compose exec app php artisan db:seed --class=CandleSeeder
    ```

3. Соберите фронтенд:
    ```bash
    npm run build
    # или для разработки:
    npm run dev
    ```

### Доступ к графикам

1. Откройте приложение в браузере: `http://localhost`
2. Войдите в систему (если требуется аутентификация)
3. Перейдите на страницу "Графики свечей" через боковую панель
4. Выберите параметры:
    - Валютную пару (например, BTC/USDT)
    - Биржу (например, Binance)
    - Таймфрейм (например, 1 минута)
    - При необходимости укажите диапазон дат
5. Нажмите "Загрузить график"

### Параметры API

#### Получение метаданных

```
GET /api/candles/meta
```

Возвращает список доступных валютных пар, бирж и таймфреймов.

#### Получение свечей

```
GET /api/candles?currency_pair=ID&exchange=ID&timeframe=ID&limit=100
```

Параметры:

- `currency_pair` - ID валютной пары или символ (например, "BTC/USDT")
- `exchange` - ID биржи или код (например, "BINANCE")
- `timeframe` - ID таймфрейма или название (например, "1 минута")
- `limit` - максимальное количество свечей (по умолчанию 100)
- `from` - дата начала (опционально)
- `to` - дата окончания (опционально)

#### Получение статистики

```
GET /api/candles/stats?currency_pair=ID&exchange=ID&timeframe=ID
```

Возвращает статистику по указанным параметрам.

## Технические детали

### Зависимости

- `lightweight-charts` v5.0.8 - библиотека для отображения графиков
- React, TypeScript, Tailwind CSS - фронтенд стек

### Структура данных свечей

```typescript
interface CandleData {
    id: number;
    open_time: number; // timestamp в миллисекундах
    close_time: number;
    ohlcv: {
        open: number;
        high: number;
        low: number;
        close: number;
        volume: number;
    };
    // ... другие поля
}
```

### Цвета графика

- Зеленые свечи (рост): `#4ade80`
- Красные свечи (падение): `#f87171`

## Возможные расширения

1. Добавление индикаторов (MA, RSI, MACD)
2. Возможность сохранения графиков
3. Экспорт данных
4. Алерты и уведомления
5. Сравнение нескольких инструментов
6. Более детальная настройка внешнего вида

## Troubleshooting

### Нет данных на графике

1. Проверьте, что выбраны правильные параметры
2. Убедитесь, что в базе есть данные для выбранной комбинации
3. Проверьте консоль браузера на ошибки

### График не отображается

1. Убедитесь, что lightweight-charts установлен: `npm list lightweight-charts`
2. Проверьте консоль браузера на ошибки JavaScript
3. Убедитесь, что фронтенд собран: `npm run build`

### API возвращает пустой результат

1. Проверьте параметры запроса
2. Убедитесь, что сидеры выполнены: `docker-compose exec app php artisan db:seed --class=CandleSeeder`
